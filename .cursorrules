# Cursor Rules for Regretless-3

## Dark Mode Theme Requirements

**CRITICAL**: When creating or modifying any UI component, page, or styling code:

1. **Always use the `useTheme` hook** from `contexts/ThemeContext` instead of static theme imports
2. **Use semantic color tokens** from `theme.colors.*` (e.g., `theme.colors.background.page`, `theme.colors.text.primary`)
3. **Never use hardcoded colors** like `#FFFFFF`, `#000000`, etc. - always use theme colors
4. **Wrap StyleSheet.create in useMemo** with a `createStyles(theme)` function pattern
5. **Ensure dark mode support** - all colors should adapt automatically via the theme system
6. **Check StatusBar styling** - use `StatusBar` from `expo-status-bar` with `style={isDark ? 'light' : 'dark'}`
7. **For BlurView components** - set `tint={isDark ? "dark" : "light"}` and consider adding a `key` prop to force re-render on theme changes

### Example Pattern:

```typescript
const MyComponent = () => {
  const { theme, isDark } = useTheme();
  const styles = useMemo(() => createStyles(theme), [theme]);
  // ... component code
};

const createStyles = (theme: Theme) => StyleSheet.create({
  container: {
    backgroundColor: theme.colors.background.page, // NOT '#FFFFFF'
    // ... other styles using theme colors
  },
});
```

### Safe Area Patterns:

- Use `SafeAreaView` from `react-native-safe-area-context` with `edges={['top']}` for headers
- Match the pattern used in `NotificationSettingsPage.tsx` and `DisplaySettingsPage.tsx`

## Database Schema Documentation

**CRITICAL**: When making any database changes (creating/modifying tables, views, functions, triggers, indexes, RLS policies, etc.):

1. **Always update `backend/database/schema.md`** to reflect the changes
2. Document new tables, columns, constraints, and relationships
3. Update any affected views, functions, or triggers in the documentation
4. Include SQL setup examples if adding new tables
5. Update RLS policies section if security changes are made
6. Keep the schema documentation in sync with the actual database state

## Supabase MCP Usage

**CRITICAL**: When working with Supabase database operations:

1. **Always use Supabase MCP tools** instead of direct SQL queries or client library calls when:
   - Executing database queries or migrations
   - Checking database schema (tables, columns, indexes)
   - Applying migrations (use `mcp_supabase_apply_migration` for DDL operations)
   - Executing SQL queries (use `mcp_supabase_execute_sql` for DML operations)
   - Checking logs, advisors, or project configuration
   - Working with Edge Functions
   - Managing development branches

2. **For DDL operations** (CREATE, ALTER, DROP): Always use `mcp_supabase_apply_migration` with a descriptive migration name in snake_case

3. **For DML operations** (SELECT, INSERT, UPDATE, DELETE): Use `mcp_supabase_execute_sql` for queries that don't modify schema

4. **Before making schema changes**: Use `mcp_supabase_list_tables` and `mcp_supabase_list_migrations` to understand current state

5. **After making changes**: Use `mcp_supabase_get_advisors` to check for security vulnerabilities or performance issues

6. **For documentation**: Use `mcp_supabase_search_docs` to find up-to-date Supabase documentation when needed
